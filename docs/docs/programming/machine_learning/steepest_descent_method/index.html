<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>勾配法(最急降下法) | WAT Notes</title>

<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<link rel="stylesheet" href="https://WAT36.github.io/pages/book.min.e2750c58bf0545d36d2426996f9d6108a275d000f33e7552d83ea28bdcd34ab7.css">


<script defer src="https://WAT36.github.io/pages/search.min.664bf2aebd366e0a582744146160ee605843b49427c9667e8c2b7f4279cbd784.js"></script>



<link rel="icon" href="https://WAT36.github.io/pages/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://WAT36.github.io/pages/">WAT Notes</a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2fprogramming\2fmachine_learning\2fsteepest_descent_method\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="https://WAT36.github.io/pages/"><strong>Introduction</strong></a></li>
<li><a href="https://WAT36.github.io/pages/docs/programming/jp_index/"><strong>プログラミング</strong></a></li>
<li><a href="https://WAT36.github.io/pages/docs/ctf/ctf_index/"><strong>CTF</strong></a></li>
<li><a href="https://WAT36.github.io/pages/posts/"><strong>Blog</strong></a></li>
<li><a href="https://WAT36.github.io/pages/docs/sample/sample_index/">サンプルページ</a></li>
</ul>








  <div class="page-nav-item">
    <a href="https://WAT36.github.io/pages/categories/">Categories</a>
  </div>
  <br>
  <div class="page-nav-item">
    <a href="https://WAT36.github.io/pages/tags/">Tags</a>
  </div>
</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="https://WAT36.github.io/pages/svg/menu.svg" alt="Menu" />
  </label>
  <strong>勾配法(最急降下法)</strong>
</header>

      
<article class="markdown">

<h1 id="勾配法-最急降下法">勾配法(最急降下法)</h1>

<p>前述の平均二乗誤差で最も誤差が小さくなるw<sub>0</sub>,w<sub>1</sub>を正確に求めるにはどうすればよいのか？</p>

<p>その一例として、ここでは<strong>勾配法</strong>という方法についてを述べる。</p>

<p>勾配法とは曲面(2変数関数のグラフ)において、最初にある座標を定めて曲面の傾きを求め、そこから傾きの方向(=曲面の座標が低くなる方向)へ座標を移していく、という動作を繰り返し、最終的に傾き0の座標にたどり着くことで曲面が最も小さくなる座標を求めるという方法である。</p>

<p>前述の平均二乗誤差Jにおいて、この勾配法を利用し最もJが小さくなるw<sub>0</sub>,w<sub>1</sub>の組み合わせを求めることを考える。</p>

<p>平均二乗誤差Jの(w<sub>0</sub>,w<sub>1</sub>)での傾きは以下のように表される。</p>

<math>
<mi>∇</mi>
<mi>J</mi>
<mo>=</mo>
<mfenced open="[" close="]"> <mtable>
<mtr> 
    <mtd>
    <mfrac> 
        <mrow><mo>&part;</mo><mi>J</mi></mrow> 
        <mrow><mo>&part;</mo><msub><mi>w</mi><mn>0</mn></msub></mrow>
    </mfrac>
    </mtd>
</mtr> 
<mtr>
    <mtd>
    <mfrac> 
        <mrow><mo>&part;</mo><mi>J</mi></mrow> 
        <mrow><mo>&part;</mo><msub><mi>w</mi><mn>1</mn></msub></mrow>
    </mfrac>
    </mtd>
</mtr>
</mtable> 
</mfenced>
<mo>=</mo>
<mfenced open="[" close="]"> 
<mtable>
<mtr> 
    <mtd>
    <mfrac> 
        <mn>2</mn> 
        <mi>N</mi>
    </mfrac>
    <munderover> 
        <mo>&Sum;</mo> 
            <mrow>
                <mi>n</mi>
                <mo>=</mo>
                <mn>0</mn> 
            </mrow>
            <mi>N-1</mi> 
    </munderover> 
    <mo>(</mo>
    <msub>
        <mi>y</mi>
        <mi>n</mi> 
    </msub>
    <mo>-</mo>
    <msub>
        <mi>t</mi>
        <mi>n</mi> 
    </msub>
    <mo>)</mo>
    <msub>
        <mi>x</mi>
        <mi>n</mi> 
    </msub>
    </mtd>
</mtr> 
<mtr>
    <mtd>
    <mfrac> 
        <mn>2</mn> 
        <mi>N</mi>
    </mfrac>
    <munderover> 
        <mo>&Sum;</mo> 
            <mrow>
                <mi>n</mi>
                <mo>=</mo>
                <mn>0</mn> 
            </mrow>
        <mi>N-1</mi> 
    </munderover> 
    <mo>(</mo>
    <msub>
        <mi>y</mi>
        <mi>n</mi> 
    </msub>
    <mo>-</mo>
    <msub>
        <mi>t</mi>
        <mi>n</mi> 
    </msub>
    <mo>)</mo>
    </mtd>
</mtr>
</mtable> 
</mfenced>
</math>

<p>この値はそれぞれJのw<sub>0</sub>,w<sub>1</sub>に関する傾きを示している。</p>

<p>これを利用し、w<sub>0</sub>,w<sub>1</sub>の座標を移動させることで、傾きが0かつJの値が低くなる方向へと近づけていく。</p>

<p><b>w</b> = [w<sub>0</sub>,w<sub>1</sub>] とし、t回移動させた後の<b>w</b>を<b>w</b>(t)とすると、以下の漸化式が成り立つ。</p>

<math>
<mi mathvariant="bold-italic">w</mi>
<mo>(</mo>
<mi>t</mi>
<mo>+</mo>
<mn>1</mn>
<mo>)</mo>
<mo>=</mo>
<mi mathvariant="bold-italic">w</mi>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
<mo>=</mo>
<mi>α</mi>
<mi>∇</mi>
<mi>J</mi>
<mfenced open="|" close=""> <mi></mi>
</mfenced>
<msub>
<mi></mi>
<mrow>
    <mi mathvariant="bold-italic">w</mi>
    <mo>(</mo>
    <mi>t</mi>
    <mo>)</mo>
</mrow>
</msub>

</math>

<p>ここでαは<strong>学習率</strong>と呼ばれるパラメータで、1回の移動で<b>w</b>をどれだけ移動させるかの度合を示す。</p>

<p>w<sub>0</sub>,w<sub>1</sub>それぞれで表すと以下のようになる。</p>

<math>
<msub>
<mi>w</mi>
<mn>0</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>+</mo>
<mn>1</mn>
<mo>)</mo>
<mo>=</mo>
<msub>
<mi>w</mi>
<mn>0</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
<mo>-</mo>
<mi>α</mi>
    <mfrac> 
        <mrow><mo>&part;</mo><mi>J</mi></mrow> 
        <mrow><mo>&part;</mo><msub><mi>w</mi><mn>0</mn></msub></mrow>
    </mfrac>
<mfenced open="|" close=""> 
<mi></mi>
</mfenced>
<msub>
<mi></mi>
<mrow>
<msub>
<mi>w</mi>
<mn>0</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
<mo>,</mo>
<msub>
<mi>w</mi>
<mn>1</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
</mrow>
</msub>
</math>
<br>
<math>
<msub>
<mi>w</mi>
<mn>1</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>+</mo>
<mn>1</mn>
<mo>)</mo>
<mo>=</mo>
<msub>
<mi>w</mi>
<mn>1</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
<mo>-</mo>
<mi>α</mi>
    <mfrac> 
        <mrow><mo>&part;</mo><mi>J</mi></mrow> 
        <mrow><mo>&part;</mo><msub><mi>w</mi><mn>1</mn></msub></mrow>
    </mfrac>
<mfenced open="|" close=""> 
<mi></mi>
</mfenced>
<msub>
<mi></mi>
<mrow>
<msub>
<mi>w</mi>
<mn>0</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
<mo>,</mo>
<msub>
<mi>w</mi>
<mn>1</mn>
</msub>
<mo>(</mo>
<mi>t</mi>
<mo>)</mo>
</mrow>
</msub>
</math>

<p>それではこの式を利用するために、この式に出てくるJをw<sub>0</sub>,w<sub>1</sub>で偏微分した値を求めてみよう。</p>

<p>まずJは前述の平均二乗誤差の定義から以下のような式である。</p>

<p>(Jの定義式を載せる)</p>

<p>yn = w<sub>0</sub> x + w<sub>1</sub> より</p>

<p>(J = 右辺はyを展開した式)</p>

<p>これをw<sub>0</sub>,w<sub>1</sub>でそれぞれ偏微分すると</p>

<p>(Jを偏微分した式)</p>

<p>になる。これより、上式は</p>

<p>w<sub>0</sub>(t+1) = w<sub>0</sub>(t) - α(↑で求めた式)</p>

<p>w<sub>1</sub>(t+1) = w<sub>1</sub>(t) - α(↑で求めた式)</p>

<p>となる。これを利用して求めてみよう。</p>

<p>コード例を以下に記載する。</p>

<p>まずは平均二乗誤差Jのw<sub>0</sub>,<sub>1</sub>における勾配(↑の　Jを偏微分した式　というやつ)を求める関数をd_mseとおくと以下のようになる。(w,x,tを入力)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">d_mse</span>(w,x,t):
    y <span style="color:#f92672">=</span> w[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> x <span style="color:#f92672">+</span> w[<span style="color:#ae81ff">1</span>]
    d_w0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>mean((y<span style="color:#f92672">-</span>t)<span style="color:#f92672">*</span>x)
    d_w1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>mean(y<span style="color:#f92672">-</span>t)
    <span style="color:#66d9ef">return</span> d_w0,d_w1</code></pre></div></article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="https://github.com/alex-shpak/hugo-book/commit/625a5e402f641ff7adc7c73f1dc93c210cc07d2b" title='Last modified Mar 23, 2020 by Wataru Tsukagoshi' target="_blank" rel="noopener">
      <img src="https://WAT36.github.io/pages/svg/calendar.svg" alt="Changed" /> Mar 23, 2020
    </a>
  </div>
  
</div>


      
    </div>
    
  



  </main>

  
  
</body>

</html>
